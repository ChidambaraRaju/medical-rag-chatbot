<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üîç AI Medical Chatbot</title>
  <style>
    :root{
      --bg:#f6f9fc;
      --card:#ffffff;
      --muted:#6b7280;
      --accent-1: #0ea5a2; /* teal */
      --accent-2: #06b6d4; /* cyan */
      --user-bg: linear-gradient(135deg,#dbeafe 0%, #bfdbfe 100%);
      --assistant-bg: linear-gradient(90deg,#ffffff 0%, #f3f4f6 100%);
      --radius: 14px;
      --max-width: 820px;
    }

    *{box-sizing:border-box}
    body{font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:0; padding:2rem; color:#0f172a}

    .wrap{max-width:var(--max-width); margin:0 auto}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.9));
      border-radius:calc(var(--radius) + 6px);
      box-shadow: 0 10px 30px rgba(2,6,23,0.08);
      padding:1.25rem;
      border: 1px solid rgba(15,23,42,0.04);
    }

    header{display:flex;gap:12px;align-items:center;margin-bottom:1rem}
    .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;box-shadow:0 6px 18px rgba(3,7,18,0.08)}
    h1{font-size:1.2rem;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:0.95rem}

    #chat-box{
      max-height:62vh; /* responsive */
      overflow:auto;
      padding:0.75rem;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(250,252,255,0.6), rgba(248,249,250,0.6));
      border:1px solid rgba(2,6,23,0.03);
      margin-top:1rem;
      scroll-behavior:smooth;
    }

    .message{display:inline-block; margin:0.65rem 0; padding:0.8rem 1rem; border-radius:12px; max-width:78%; line-height:1.35}
    .message strong{display:block;font-weight:600;margin-bottom:0.35rem}

    /* assistant (left) */
    .assistant{background:var(--assistant-bg); text-align:left; border-top-left-radius:6px; box-shadow: 0 3px 10px rgba(2,6,23,0.03)}

    /* user (right) */
    .user{background:var(--user-bg); text-align:right; float:right; border-top-right-radius:6px; box-shadow: 0 6px 18px rgba(11, 61, 119, 0.04)}

    /* timestamp small line */
    .meta{display:block;font-size:0.78rem;color:var(--muted);margin-top:6px}

    form.controls{display:flex;gap:0.6rem;align-items:flex-end;margin-top:1rem}
    textarea[name="prompt"]{flex:1; min-height:54px; max-height:180px; padding:0.75rem 0.85rem; border-radius:12px; border:1px solid rgba(2,6,23,0.06); font-size:1rem; resize:none; background:white}

    .btn{display:inline-flex;gap:0.5rem; align-items:center; padding:0.62rem 0.9rem; border-radius:10px; cursor:pointer; border:none; font-weight:600}
    .btn-send{background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:white}
    .btn-clear{background:transparent;color:var(--muted); border:1px solid rgba(2,6,23,0.05); padding:0.55rem 0.8rem}

    .btn svg{width:18px;height:18px}

    .controls-column{display:flex;flex-direction:column;gap:0.5rem}

    .disclaimer{font-size:0.85rem;color:var(--muted); margin-top:0.9rem}

    /* small screens */
    @media (max-width:520px){
      :root{--max-width:96vw}
      header{gap:10px}
      h1{font-size:1rem}
      .logo{width:40px;height:40px}
      #chat-box{max-height:54vh}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo">AI</div>
        <div>
          <h1>üîç AI Medical Chatbot</h1>
          <p class="lead">Ask medical questions ‚Äî get clear, friendly explanations. Not a substitute for professional care.</p>
        </div>
      </header>

      {% if error %}
        <p class="disclaimer" style="color:#b91c1c">‚ö†Ô∏è {{ error }}</p>
      {% endif %}

      <div id="chat-box" aria-live="polite">
        {% for msg in messages %}
          <div class="message {{ msg.role }}">
            <strong>{{ msg.role|capitalize }} {% if msg.role == 'user' %}üë§{% else %}üí¨{% endif %}</strong>
            <div class="content">{{ msg.content | safe | nl2br }}</div>
            {% if msg.timestamp %}
              <span class="meta">{{ msg.timestamp }}</span>
            {% endif %}
          </div>
        {% endfor %}
      </div>

      <form method="post" action="{{ url_for('index') }}" class="controls" onsubmit="return handleSubmit(event)">
        <textarea name="prompt" placeholder="Ask a medical question... (press Enter to send, Shift+Enter for newline)" required></textarea>
        <div class="controls-column">
          <button class="btn btn-send" type="submit" aria-label="Send message">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z" fill="currentColor"/></svg>
            Send
          </button>

          <form method="get" action="{{ url_for('clear') }}" style="margin:0">
            <button type="submit" class="btn btn-clear">Clear Chat</button>
          </form>
        </div>
      </form>

      <p class="disclaimer">üìå <strong>Disclaimer:</strong> This assistant provides general information and is not a replacement for professional medical advice, diagnosis, or treatment. Always consult a qualified healthcare provider for personal care.</p>
    </div>
  </div>

  <script>
    // Auto-scroll chat-box to bottom on load
    function scrollToBottom(){
      const cb = document.getElementById('chat-box');
      if(cb) cb.scrollTop = cb.scrollHeight;
    }

    // Auto-resize textarea and handle Enter key behavior
    const textarea = document.querySelector('textarea[name="prompt"]');
    if(textarea){
      function resize(){ textarea.style.height = 'auto'; textarea.style.height = (textarea.scrollHeight) + 'px'; }
      textarea.addEventListener('input', resize);
      window.addEventListener('load', resize);

      // Enter to send, Shift+Enter for newline
      textarea.addEventListener('keydown', function(e){
        if(e.key === 'Enter' && !e.shiftKey){
          e.preventDefault();
          // submit the closest form
          const form = textarea.closest('form');
          if(form) form.requestSubmit();
        }
      });
    }

    function handleSubmit(e){
      // bump scroll after submit so the user sees latest messages on reload
      // allow normal POST to occur
      return true;
    }

    // run once
    scrollToBottom();
  </script>
</body>
</html>
